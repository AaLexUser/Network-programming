# 40. Иерархия DNS серверов (TLD, Root, Authoritative, local DNS, ...)

```{figure} ../images/05_dns/page-14.png
:name:dns-hierarchy
DNS hierarchy{cite}`доронин2024-5`
```

## Root DNS-серверы (Корневые серверы)

- **Роль:** Корневые серверы находятся на вершине иерархии DNS. Они хранят информацию о серверах доменов верхнего уровня (TLD).
- **Количество:** В мире существует 13 корневых серверов, обозначаемых буквами от A до M.
- **Пример:** Когда DNS-запрос поступает на корневой сервер, он направляет запрос к соответствующему TLD-серверу.

## TLD DNS-серверы (Серверы доменов верхнего уровня, Top-Level Domain)
```{figure} ../images/05_dns/page-16.png
:name:dns-tld-authoritative
TLD DNS-серверы and Authoritative DNS-серверы{cite}`доронин2024-5`
```

- **Роль:** TLD-серверы отвечают за хранение информации о доменах верхнего уровня, таких как `.com`, `.org`, `.net`, `.ru`, `.uk` и т.д.
- **Типы TLD:**
  - **gTLD (generic TLD)**: Общие домены, такие как `.com`, `.org`, `.net`.
  - **ccTLD (country-code TLD)**: Национальные домены, такие как `.ru`, `.us`, `.de`
- **Пример:** Если запрашивается домен `example.com`, TLD-сервер для .com предоставит информацию о сервере, ответственном за домен `example.com`.

## Авторитативные DNS-серверы (Авторитативные серверы, Authoritative Name Servers)

- **Роль:**
  - Хранят официальную (авторитативную) информацию о домене, включая записи типа A, AAAA, MX, NS, CNAME и другие.
  - Именно здесь в конечном итоге формируется «правильный» ответ о том, какой IP-адрес соответствует тому или иному имени внутри данного домена.
  - Если на запрос отвечает авторитативный сервер домена (например, ns1.example.com для домена example.com), ответ считается «окончательным» (non-recursive, authoritative answer).
- **Примечание:** Авторитативные серверы могут быть первичными (Primary) или вторичными (Secondary) для обеспечения отказоустойчивости.

## Local DNS-серверы (Локальные DNS-серверы, или рекурсивный резолвер, DNS Resolver)
```{figure} ../images/05_dns/page-17.png
:name:dns-local
Local DNS Nameserver{cite}`доронин2024-5`
```

- **Роль:**
  - Это могут быть серверы, которые находятся в сети провайдера или внутри организации.
  - Главная роль – получать запрос от пользователя (клиентского компьютера) и последовательно отправлять его на Root-серверы, TLD-серверы и авторитативные DNS-серверы, кешируя ответы, чтобы ускорить последующие запросы.
  - При первом обращении к ранее неразрешённому доменному имени локальный DNS проходит весь путь от корневых серверов, через TLD и до авторитативного. Когда эта информация закеширована, то при повторном обращении ответ можно получить быстрее.

## Кеширующие DNS-серверы (Caching DNS)

- Часто локальный DNS также выступает в роли кеширующего: хранит полученные записи (A, MX, NS и т. д.) на определённое время, определяемое полем TTL (Time To Live).
- Кеширование позволяет уменьшить нагрузку на внешние DNS-серверы и ускорить разрешение, так как при повторном запросе к тому же домену можно не обращаться повторно к корню и TLD.

## Клиентские DNS-резолверы

- На практике конечные системы (ПК, смартфоны, серверы приложений) используют упрощённую библиотеку резолвера (stub resolver). Она просто знает, к какому локальному DNS-серверу обращаться.
- Stub resolver почти не хранит кэш, а всю работу по рекурсии и кешированию перекладывает на «полноценный» DNS Resolver (локальный или у провайдера).

```{bibliography}
:filter: docname in docnames
:style: unsrt
```