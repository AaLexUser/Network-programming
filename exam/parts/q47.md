# 47. Dynamic updates attack, TSIG, Phishing

## 1. Dynamic Updates Attack (Атака на динамические обновления DNS)

```{figure} ../images/05_dns/page-40.png
:name:doronin-dynamic-updates
Dynamic updates attack{cite}`доронин2024-5`
```

**Что это?**
Динамические обновления DNS позволяют клиентам автоматически обновлять DNS-записи на сервере. Это полезно, например, для DHCP-серверов, которые добавляют записи для новых устройств. Однако, если эта функция неправильно настроена, злоумышленник может использовать её для внесения вредоносных записей в DNS (например, подмены IP-адресов).

**Как это работает?**

- Злоумышленник отправляет поддельный запрос на динамическое обновление DNS, изменяя записи (например, A-запись или MX-запись).
- Это может привести к перенаправлению трафика на подконтрольный злоумышленнику сервер (например, для фишинга или атак типа "человек посередине").

**Защита:**

- Ограничьте возможность динамических обновлений только доверенными источниками (например, определёнными IP-адресами или сетями).
- Используйте TSIG (Transaction Signature) для аутентификации запросов на обновление.
- Регулярно проверяйте DNS-записи на наличие несанкционированных изменений.

---

## 2. TSIG (Transaction Signature)

### Что это?
```{glossary}
TSIG (Transaction SIGnature)
    это протокол безопасности, используемый в системе доменных имен (DNS) для аутентификации и обеспечения целостности сообщений между DNS-серверами. TSIG особенно полезен при выполнении динамических обновлений DNS и при передаче зон между первичными и вторичными DNS-серверами.
```

### Как это работает?

1. **Общий секрет (Shared Secret)**:

- TSIG использует симметричный ключ, который предварительно согласовывается между участвующими DNS-серверами. Этот ключ должен быть известен только доверенным сторонам для обеспечения безопасности.

2. **Алгоритмы хеширования:**

- TSIG использует криптографические хеш-функции, такие как HMAC-MD5 или HMAC-SHA, для создания цифровой подписи (MAC — Message Authentication Code) сообщений DNS. Алгоритм хеширования определяется при настройке TSIG.
- HMAC обеспечивает как целостность данных, так и подтверждение подлинности отправителя.

3. **Процесс подписания сообщения:**

- **Генерация подписи**: Отправитель DNS-сервера берет все релевантные части DNS-сообщения (обычно заголовок и определённые записи) и использует общий секрет вместе с HMAC для создания цифровой подписи (TSIG-запись).
- **Включение подписи в сообщение**: Сгенерированная TSIG-запись добавляется к DNS-сообщению перед его отправкой.
- **TSIG timestamp**: При генерации TSIG-подписи отправитель добавляет текущую временную метку (обычно в формате количества секунд с начала эпохи UNIX) в TSIG-запись. Даже если злоумышленник перехватит и попытается повторно отправить сообщение, временная метка окажется устаревшей, и сообщение будет отвергнуто.

4. **Процесс проверки подписи**:

- **Получение сообщения**: Приёмник получает DNS-сообщение вместе с TSIG-записью.
- **Валидация подписи**: Получатель использует тот же общий секрет и HMAC для вычисления подписи на основе полученного сообщения и сравнивает её с присланной TSIG-записью.
- **Аутентификация**: Если подписи совпадают, сообщение считается аутентифицированным и неизменённым. В противном случае сообщение отвергается как подделанное или повреждённое.

```{figure} ../images/05_dns/page-41.png
:name:doronin-tsig
TSIG{cite}`доронин2024-5`
```

```{figure} ../images/05_dns/page-42.png
:name:doronin-tsig-timestamp
TSIG Timestamp{cite}`доронин2024-5`
```

---

### 3. Phishing (Фишинг)

**Что это?**
Фишинг — это вид кибератаки, при котором злоумышленник пытается обманом получить конфиденциальную информацию (например, логины, пароли, данные банковских карт). Часто фишинг осуществляется через поддельные веб-сайты или электронные письма.

**Как это связано с DNS?**

- Злоумышленник может подменить DNS-записи (например, через атаку на динамические обновления или кэш-отравление), чтобы перенаправить жертву на поддельный сайт.
- Пример: пользователь вводит `example.com`, но из-за подмены DNS попадает на сайт злоумышленника, который выглядит как `example.com`.

```{figure} ../images/05_dns/page-43.png
:name:doronin-phishing
Phishing{cite}`доронин2024-5`
```


```{bibliography}
:style: unsrt
:filter: docname in docnames
```
